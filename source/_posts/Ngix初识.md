---
title: Ngixåˆè¯†
tags:
  - æ¶æ„
  - Nginx
categories:
  - ä¸“æ 
  - å‰ç«¯
toc: false
date: 2019-08-01 14:21:35
---

## ä¸€ã€ ä»€ä¹ˆæ˜¯Nginx

## äºŒã€ Nginxçš„åŠŸèƒ½

- 	ä½œä¸ºä¸€ä¸ªHTTPæœåŠ¡å™¨è¿›è¡Œç½‘ç«™çš„å‘å¸ƒå¤„ç†
- 	é«˜æ€§èƒ½çš„HTTPæœåŠ¡å™¨å’Œåå‘ä»£ç†æœåŠ¡å™¨
- 	IMAPã€POP3ã€SMTPä»£ç†æœåŠ¡å™¨é‚®ä»¶ä»£ç†æœåŠ¡å™¨
- 	ä½œä¸ºåå‘ä»£ç†è¿›è¡Œè´Ÿè½½å‡è¡¡
	
	### 2.1 Httpå’Œåå‘ä»£ç†åŠŸèƒ½
	
	2.1.1 äº†è§£ä»£ç†æ¦‚å¿µ

	æ‰€è°“ä»£ç†å°±æ˜¯ä¸€ä¸ªä»£è¡¨ã€ä¸€ä¸ªé€šé“.åœ¨è¯´åå‘ä»£ç†ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹æ­£å‘ä»£ç†ï¼Œæ­£å‘ä»£ç†ä¹Ÿæ˜¯å¤§å®¶æœ€å¸¸æ¥è§¦çš„åˆ°çš„ä»£ç†æ¨¡å¼ï¼Œæˆ‘ä»¬ä¼šä»ä¸¤ä¸ªæ–¹é¢æ¥è¯´å…³äºæ­£å‘ä»£ç†çš„å¤„ç†æ¨¡å¼ï¼Œåˆ†åˆ«ä»è½¯ä»¶æ–¹é¢å’Œç”Ÿæ´»æ–¹é¢æ¥è§£é‡Šä¸€ä¸‹ä»€ä¹ˆå«æ­£å‘ä»£ç†ã€‚

	æ­£å‘ä»£ç†çš„ç”¨é€”ï¼š
	ï¼ˆ1ï¼‰è®¿é—®åŸæ¥æ— æ³•è®¿é—®çš„èµ„æºï¼Œå¦‚Google
	ï¼ˆ2ï¼‰ å¯ä»¥åšç¼“å­˜ï¼ŒåŠ é€Ÿè®¿é—®èµ„æº
	ï¼ˆ3ï¼‰å¯¹å®¢æˆ·ç«¯è®¿é—®æˆæƒï¼Œä¸Šç½‘è¿›è¡Œè®¤è¯
	ï¼ˆ4ï¼‰ä»£ç†å¯ä»¥è®°å½•ç”¨æˆ·è®¿é—®è®°å½•ï¼ˆä¸Šç½‘è¡Œä¸ºç®¡ç†ï¼‰ï¼Œå¯¹å¤–éšè—ç”¨æˆ·ä¿¡æ¯

	åœ¨å¦‚ä»Šçš„ç½‘ç»œç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬å¦‚æœç”±äºæŠ€æœ¯éœ€è¦è¦å»è®¿é—®å›½å¤–çš„æŸäº›ç½‘ç«™ï¼Œæ­¤æ—¶ä½ ä¼šå‘ç°ä½äºå›½å¤–çš„æŸç½‘ç«™æˆ‘ä»¬é€šè¿‡æµè§ˆå™¨æ˜¯æ²¡æœ‰åŠæ³•è®¿é—®çš„ï¼Œæ­¤æ—¶å¤§å®¶å¯èƒ½éƒ½ä¼šç”¨ä¸€ä¸ªæ“ä½œFQè¿›è¡Œè®¿é—®ï¼ŒFQçš„æ–¹å¼ä¸»è¦æ˜¯æ‰¾åˆ°ä¸€ä¸ªå¯ä»¥è®¿é—®å›½å¤–ç½‘ç«™çš„ä»£ç†æœåŠ¡å™¨ï¼Œæˆ‘ä»¬å°†è¯·æ±‚å‘é€ç»™ä»£ç†æœåŠ¡å™¨ï¼Œä»£ç†æœåŠ¡å™¨å»è®¿é—®å›½å¤–çš„ç½‘ç«™ï¼Œç„¶åå°†è®¿é—®åˆ°çš„æ•°æ®ä¼ é€’ç»™æˆ‘ä»¬ï¼
	
	ä¸Šè¿°è¿™æ ·çš„ä»£ç†æ¨¡å¼ç§°ä¸ºæ­£å‘ä»£ç†ï¼Œæ­£å‘ä»£ç†æœ€å¤§çš„ç‰¹ç‚¹æ˜¯**å®¢æˆ·ç«¯éå¸¸æ˜ç¡®è¦è®¿é—®çš„æœåŠ¡å™¨åœ°å€**ï¼›æœåŠ¡å™¨åªæ¸…æ¥šè¯·æ±‚æ¥è‡ªå“ªä¸ªä»£ç†æœåŠ¡å™¨ï¼Œè€Œä¸æ¸…æ¥šæ¥è‡ªå“ªä¸ªå…·ä½“çš„å®¢æˆ·ç«¯ï¼›æ­£å‘ä»£ç†æ¨¡å¼**å±è”½æˆ–è€…éšè—äº†çœŸå®å®¢æˆ·ç«¯ä¿¡æ¯**ã€‚

	ps: å®¢æˆ·ç«¯å¿…é¡»è®¾ç½®æ­£å‘ä»£ç†æœåŠ¡å™¨ï¼Œå½“ç„¶å‰ææ˜¯è¦çŸ¥é“æ­£å‘ä»£ç†æœåŠ¡å™¨çš„IPåœ°å€ï¼Œè¿˜æœ‰ä»£ç†ç¨‹åºçš„ç«¯å£(ç½‘ç»œé“¾æ¥=>å±€åŸŸç½‘è®¾ç½®=>é«˜çº§)ã€‚

	æ€»ç»“æ¥è¯´ï¼šæ­£å‘ä»£ç†ï¼Œ"**å®ƒä»£ç†çš„æ˜¯å®¢æˆ·ç«¯ï¼Œä»£å®¢æˆ·ç«¯å‘å‡ºè¯·æ±‚**"ï¼Œæ˜¯ä¸€ä¸ªä½äºå®¢æˆ·ç«¯å’ŒåŸå§‹æœåŠ¡å™¨(origin server)ä¹‹é—´çš„æœåŠ¡å™¨ï¼Œä¸ºäº†ä»åŸå§‹æœåŠ¡å™¨å–å¾—å†…å®¹ï¼Œå®¢æˆ·ç«¯å‘ä»£ç†å‘é€ä¸€ä¸ªè¯·æ±‚å¹¶æŒ‡å®šç›®æ ‡(åŸå§‹æœåŠ¡å™¨)ï¼Œç„¶åä»£ç†å‘åŸå§‹æœåŠ¡å™¨è½¬äº¤è¯·æ±‚å¹¶å°†è·å¾—çš„å†…å®¹è¿”å›ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯å¿…é¡»è¦è¿›è¡Œä¸€äº›ç‰¹åˆ«çš„è®¾ç½®æ‰èƒ½ä½¿ç”¨æ­£å‘ä»£ç†ã€‚

	2.1.2 åå‘ä»£ç†

	å¤šä¸ªå®¢æˆ·ç«¯ç»™æœåŠ¡å™¨å‘é€çš„è¯·æ±‚ï¼ŒNginxæœåŠ¡å™¨æ¥æ”¶åˆ°ä¹‹åï¼ŒæŒ‰ç…§ä¸€å®šçš„è§„åˆ™åˆ†å‘ç»™äº†åç«¯çš„ä¸šåŠ¡å¤„ç†æœåŠ¡å™¨è¿›è¡Œå¤„ç†äº†ã€‚æ­¤æ—¶~è¯·æ±‚çš„æ¥æºä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯æ˜¯æ˜ç¡®çš„ï¼Œä½†æ˜¯è¯·æ±‚å…·ä½“ç”±å“ªå°æœåŠ¡å™¨å¤„ç†çš„å¹¶ä¸æ˜ç¡®äº†ï¼ŒNginxæ‰®æ¼”çš„å°±æ˜¯ä¸€ä¸ªåå‘ä»£ç†è§’è‰²ã€‚

	å®¢æˆ·ç«¯æ˜¯æ— æ„ŸçŸ¥ä»£ç†çš„å­˜åœ¨çš„ï¼Œåå‘ä»£ç†å¯¹å¤–éƒ½æ˜¯é€æ˜çš„ï¼Œè®¿é—®è€…å¹¶ä¸çŸ¥é“è‡ªå·±è®¿é—®çš„æ˜¯ä¸€ä¸ªä»£ç†ã€‚å› ä¸ºå®¢æˆ·ç«¯ä¸éœ€è¦ä»»ä½•é…ç½®å°±å¯ä»¥è®¿é—®ã€‚

	åå‘ä»£ç†ï¼Œ"å®ƒä»£ç†çš„æ˜¯æœåŠ¡ç«¯ï¼Œä»£æœåŠ¡ç«¯æ¥æ”¶è¯·æ±‚"ï¼Œä¸»è¦ç”¨äºæœåŠ¡å™¨é›†ç¾¤åˆ†å¸ƒå¼éƒ¨ç½²çš„æƒ…å†µä¸‹ï¼Œåå‘ä»£ç†éšè—äº†æœåŠ¡å™¨çš„ä¿¡æ¯ã€‚

	åå‘ä»£ç†çš„ä½œç”¨ï¼š
	ï¼ˆ1ï¼‰ä¿è¯å†…ç½‘çš„å®‰å…¨ï¼Œé€šå¸¸å°†åå‘ä»£ç†ä½œä¸ºå…¬ç½‘è®¿é—®åœ°å€ï¼ŒWebæœåŠ¡å™¨æ˜¯å†…ç½‘
	ï¼ˆ2ï¼‰è´Ÿè½½å‡è¡¡ï¼Œé€šè¿‡åå‘ä»£ç†æœåŠ¡å™¨æ¥ä¼˜åŒ–ç½‘ç«™çš„è´Ÿè½½

	
	2.1.3 æ­£åä»£ç†åŒºåˆ«

	å›¾è§£:

	

	
- 	åœ¨æ­£å‘ä»£ç†ä¸­ï¼ŒProxyå’ŒClientåŒå±äºä¸€ä¸ªLANï¼ˆå›¾ä¸­æ–¹æ¡†å†…ï¼‰ï¼Œéšè—äº†å®¢æˆ·ç«¯ä¿¡æ¯ï¼›
- 
- 	åœ¨åå‘ä»£ç†ä¸­ï¼ŒProxyå’ŒServeråŒå±äºä¸€ä¸ªLANï¼ˆå›¾ä¸­æ–¹æ¡†å†…ï¼‰ï¼Œéšè—äº†æœåŠ¡ç«¯ä¿¡æ¯ï¼›
- 
- 	å®é™…ä¸Šï¼ŒProxyåœ¨ä¸¤ç§ä»£ç†ä¸­åšçš„äº‹æƒ…éƒ½æ˜¯æ›¿æœåŠ¡å™¨ä»£ä¸ºæ”¶å‘è¯·æ±‚å’Œå“åº”ï¼Œä¸è¿‡ä»ç»“æ„ä¸Šçœ‹æ­£å¥½å·¦å³äº’æ¢äº†ä¸€ä¸‹ï¼Œæ‰€ä»¥æŠŠåå‡ºç°çš„é‚£ç§ä»£ç†æ–¹å¼ç§°ä¸ºåå‘ä»£ç†äº†ã€‚

### 2.2 è´Ÿè½½å‡è¡¡

	Nginxæ‰®æ¼”äº†åå‘ä»£ç†æœåŠ¡å™¨çš„è§’è‰²ï¼Œå®ƒæ˜¯ä»¥ä¾æ®ä»€ä¹ˆæ ·çš„è§„åˆ™è¿›è¡Œè¯·æ±‚åˆ†å‘çš„å‘¢ï¼Ÿä¸ç”¨çš„é¡¹ç›®åº”ç”¨åœºæ™¯ï¼Œåˆ†å‘çš„è§„åˆ™æ˜¯å¦å¯ä»¥æ§åˆ¶å‘¢ï¼Ÿ

	è¿™é‡Œæåˆ°çš„å®¢æˆ·ç«¯å‘é€çš„ã€Nginxåå‘ä»£ç†æœåŠ¡å™¨æ¥æ”¶åˆ°çš„è¯·æ±‚æ•°é‡ï¼Œå°±æ˜¯æˆ‘ä»¬è¯´çš„è´Ÿè½½é‡ã€‚

	è¯·æ±‚æ•°é‡æŒ‰ç…§ä¸€å®šçš„è§„åˆ™è¿›è¡Œåˆ†å‘åˆ°ä¸åŒçš„æœåŠ¡å™¨å¤„ç†çš„è§„åˆ™ï¼Œå°±æ˜¯ä¸€ç§å‡è¡¡è§„åˆ™(åˆç§°è´Ÿè½½å‡è¡¡ç­–ç•¥)ã€‚

	æ‰€ä»¥~å°†æœåŠ¡å™¨æ¥æ”¶åˆ°çš„è¯·æ±‚æŒ‰ç…§è§„åˆ™åˆ†å‘çš„è¿‡ç¨‹ï¼Œç§°ä¸ºè´Ÿè½½å‡è¡¡ã€‚

	è´Ÿè½½æ–¹å¼:

- 	ç¡¬ä»¶è´Ÿè½½(ä¾‹å¦‚F5è´Ÿè½½ç­–ç•¥)
- 	è½¯ä»¶è´Ÿè½½(è½¯ä»¶å±‚çš„æ¶ˆæ¯é˜Ÿåˆ—åˆ†å‘æœºåˆ¶)

	Nginxæ”¯æŒçš„è´Ÿè½½å‡è¡¡è°ƒåº¦ç®—æ³•æ–¹å¼å¦‚ä¸‹ï¼š

- 	weightè½®è¯¢(é»˜è®¤ï¼Œå¸¸ç”¨)ï¼šæ¥æ”¶åˆ°çš„è¯·æ±‚æŒ‰ç…§æƒé‡åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ï¼Œå³ä½¿åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼ŒæŸä¸€å°åç«¯æœåŠ¡å™¨å®•æœºï¼ŒNginxä¼šè‡ªåŠ¨å°†è¯¥æœåŠ¡å™¨å‰”é™¤å‡ºé˜Ÿåˆ—ï¼Œè¯·æ±‚å—ç†æƒ…å†µä¸ä¼šå—åˆ°ä»»ä½•å½±å“ã€‚ è¿™ç§æ–¹å¼ä¸‹ï¼Œå¯ä»¥ç»™ä¸åŒçš„åç«¯æœåŠ¡å™¨è®¾ç½®ä¸€ä¸ªæƒé‡å€¼(weight)ï¼Œç”¨äºè°ƒæ•´ä¸åŒçš„æœåŠ¡å™¨ä¸Šè¯·æ±‚çš„åˆ†é…ç‡ï¼›æƒé‡æ•°æ®è¶Šå¤§ï¼Œè¢«åˆ†é…åˆ°è¯·æ±‚çš„å‡ ç‡è¶Šå¤§ï¼›è¯¥æƒé‡å€¼ï¼Œä¸»è¦æ˜¯é’ˆå¯¹å®é™…å·¥ä½œç¯å¢ƒä¸­ä¸åŒçš„åç«¯æœåŠ¡å™¨ç¡¬ä»¶é…ç½®è¿›è¡Œè°ƒæ•´çš„ã€‚
- 	ip_hashï¼ˆå¸¸ç”¨ï¼‰ï¼šæ¯ä¸ªè¯·æ±‚æŒ‰ç…§å‘èµ·å®¢æˆ·ç«¯çš„ipçš„hashç»“æœè¿›è¡ŒåŒ¹é…ï¼Œè¿™æ ·çš„ç®—æ³•ä¸‹ä¸€ä¸ªå›ºå®šipåœ°å€çš„å®¢æˆ·ç«¯æ€»ä¼šè®¿é—®åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œè¿™ä¹Ÿåœ¨ä¸€å®šç¨‹åº¦ä¸Šè§£å†³äº†é›†ç¾¤éƒ¨ç½²ç¯å¢ƒä¸‹sessionå…±äº«çš„é—®é¢˜ã€‚
- fairï¼šæ™ºèƒ½è°ƒæ•´è°ƒåº¦ç®—æ³•ï¼ŒåŠ¨æ€çš„æ ¹æ®åç«¯æœåŠ¡å™¨çš„è¯·æ±‚å¤„ç†åˆ°å“åº”çš„æ—¶é—´è¿›è¡Œå‡è¡¡åˆ†é…ï¼Œå“åº”æ—¶é—´çŸ­å¤„ç†æ•ˆç‡é«˜çš„æœåŠ¡å™¨åˆ†é…åˆ°è¯·æ±‚çš„æ¦‚ç‡é«˜ï¼Œå“åº”æ—¶é—´é•¿å¤„ç†æ•ˆç‡ä½çš„æœåŠ¡å™¨åˆ†é…åˆ°çš„è¯·æ±‚å°‘ï¼›ç»“åˆäº†å‰ä¸¤è€…çš„ä¼˜ç‚¹çš„ä¸€ç§è°ƒåº¦ç®—æ³•ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯Nginxé»˜è®¤ä¸æ”¯æŒfairç®—æ³•ï¼Œå¦‚æœè¦ä½¿ç”¨è¿™ç§è°ƒåº¦ç®—æ³•ï¼Œè¯·å®‰è£…upstream_fairæ¨¡å—ã€‚
- 	url_hashï¼šæŒ‰ç…§è®¿é—®çš„urlçš„hashç»“æœåˆ†é…è¯·æ±‚ï¼Œæ¯ä¸ªè¯·æ±‚çš„urlä¼šæŒ‡å‘åç«¯å›ºå®šçš„æŸä¸ªæœåŠ¡å™¨ï¼Œå¯ä»¥åœ¨Nginxä½œä¸ºé™æ€æœåŠ¡å™¨çš„æƒ…å†µä¸‹æé«˜ç¼“å­˜æ•ˆç‡ã€‚åŒæ ·è¦æ³¨æ„Nginxé»˜è®¤ä¸æ”¯æŒè¿™ç§è°ƒåº¦ç®—æ³•ï¼Œè¦ä½¿ç”¨çš„è¯éœ€è¦å®‰è£…Nginxçš„hashè½¯ä»¶åŒ…ã€‚


## ä¸‰ã€ Nginxä¸å…¶ä»–æœåŠ¡å™¨çš„æ€§èƒ½æ¯”è¾ƒ

|æœåŠ¡å™¨|Apache|Nginx|
|-|-|-|
|Proxyä»£ç†|éå¸¸å¥½|éå¸¸å¥½|
|Rewriter|å¥½|éå¸¸å¥½|
|Fcgi|ä¸å¥½|å¥½|
|çƒ­éƒ¨ç½²|ä¸æ”¯æŒ|æ”¯æŒ|
|ç³»ç»Ÿå‹åŠ›|å¾ˆå¤§|å¾ˆå°|
|ç¨³å®šæ€§|å¥½|éå¸¸å¥½|
|å®‰å…¨æ€§|å¥½|ä¸€èˆ¬|
|é™æ€æ–‡ä»¶å¤„ç†|ä¸€åŠ|éå¸¸å¥½|
|åå‘ä»£ç†|ä¸€èˆ¬|éå¸¸å¥½|


## å››ã€ Nginxé…ç½®æ–‡ä»¶çš„ç¼–å†™ã€è§£æ
	
### 4.1 å¦‚ä½•ä½¿ç”¨Nginx

	4.1.1 Nginxå®‰è£…

 	4.1.2 Nginxé…ç½®

	å®‰è£…å®Œæˆä¹‹åï¼Œé…ç½®ç›®å½• conf ä¸‹æœ‰ä»¥ä¸‹é…ç½®æ–‡ä»¶ï¼Œè¿‡æ»¤æ‰äº† xx.default é…ç½®ï¼š

```

ubuntu: /opt/nginx-1.7.7/conf$ tree |grep -v default
.
â”œâ”€â”€ fastcgi.conf
â”œâ”€â”€ fastcgi_params
â”œâ”€â”€ koi-utf
â”œâ”€â”€ koi-win
â”œâ”€â”€ mime.types
â”œâ”€â”€ nginx.conf
â”œâ”€â”€ scgi_params
â”œâ”€â”€ uwsgi_params
â””â”€â”€ win-utf
```

	nginx.conf æ˜¯ä¸»é…ç½®æ–‡ä»¶ï¼Œé»˜è®¤é…ç½®å»æ‰æ³¨é‡Šä¹‹åçš„å†…å®¹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

```

worker_process      # è¡¨ç¤ºå·¥ä½œè¿›ç¨‹çš„æ•°é‡ï¼Œä¸€èˆ¬è®¾ç½®ä¸ºcpuçš„æ ¸æ•°

worker_connections  # è¡¨ç¤ºæ¯ä¸ªå·¥ä½œè¿›ç¨‹çš„æœ€å¤§è¿æ¥æ•°

server{}            # å—å®šä¹‰äº†è™šæ‹Ÿä¸»æœº

    listen          # ç›‘å¬ç«¯å£

    server_name     # ç›‘å¬åŸŸå

    location {}     # æ˜¯ç”¨æ¥ä¸ºåŒ¹é…çš„ URI è¿›è¡Œé…ç½®ï¼ŒURI å³è¯­æ³•ä¸­çš„â€œ/uri/â€

    location /{}    # åŒ¹é…ä»»ä½•æŸ¥è¯¢ï¼Œå› ä¸ºæ‰€æœ‰è¯·æ±‚éƒ½ä»¥ / å¼€å¤´

        root        # æŒ‡å®šå¯¹åº”uriçš„èµ„æºæŸ¥æ‰¾è·¯å¾„ï¼Œè¿™é‡Œhtmlä¸ºç›¸å¯¹è·¯å¾„ï¼Œå®Œæ•´è·¯å¾„ä¸º
                    # /opt/nginx-1.7.7/html/

        index       # æŒ‡å®šé¦–é¡µindexæ–‡ä»¶çš„åç§°ï¼Œå¯ä»¥é…ç½®å¤šä¸ªï¼Œä»¥ç©ºæ ¼åˆ†å¼€ã€‚å¦‚æœ‰å¤š
                    # ä¸ªï¼ŒæŒ‰é…ç½®é¡ºåºæŸ¥æ‰¾ã€‚
```

	çœŸå®ç”¨ä¾‹,å°ç¼–è‡ªå·±ngå®‰è£…è·¯å¾„ä¸‹çš„nginx.configé…ç½®æ–‡ä»¶,é»˜è®¤å¦‚ä¸‹:

```

#user  nobody;
worker_processes  1;

#error_log  logs/error.log;
#error_log  logs/error.log  notice;
#error_log  logs/error.log  info;

#pid        logs/nginx.pid;


events {
    worker_connections  1024;
}


http {
    include       mime.types;
    default_type  application/octet-stream;

    #log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
    #                  '$status $body_bytes_sent "$http_referer" '
    #                  '"$http_user_agent" "$http_x_forwarded_for"';

    #access_log  logs/access.log  main;

    sendfile        on;
    #tcp_nopush     on;

    #keepalive_timeout  0;
    keepalive_timeout  65;

    #gzip  on;

    server {
        listen       80;
        server_name  localhost;

        #charset koi8-r;

        #access_log  logs/host.access.log  main;

        location / {
            root   html;
            index  index.html index.htm;
	    
        }

        #error_page  404              /404.html;

        # redirect server error pages to the static page /50x.html
        #
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }

        # proxy the PHP scripts to Apache listening on 127.0.0.1:80
        #
	# proxy_pass åé¢è·Ÿç€ä¸€ä¸ª URLï¼Œç”¨æ¥å°†è¯·æ±‚åå‘ä»£ç†åˆ° URL å‚æ•°æŒ‡å®šçš„æœåŠ¡å™¨ä¸Š
        #location ~ \.php$ {
        #    proxy_pass   http://127.0.0.1;
        #}

        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
        #
        #location ~ \.php$ {
        #    root           html;
        #    fastcgi_pass   127.0.0.1:9000;
        #    fastcgi_index  index.php;
        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;
        #    include        fastcgi_params;
        #}

        # deny access to .htaccess files, if Apache's document root
        # concurs with nginx's one
        #
        #location ~ /\.ht {
        #    deny  all;
        #}
    }


    # another virtual host using mix of IP-, name-, and port-based configuration
    #
    #server {
    #    listen       8000;
    #    listen       somename:8080;
    #    server_name  somename  alias  another.alias;

    #    location / {
    #        root   html;
    #        index  index.html index.htm;
    #    }
    #}


    # HTTPS server
    #
    #server {
    #    listen       443 ssl;
    #    server_name  localhost;

    #    ssl_certificate      cert.pem;
    #    ssl_certificate_key  cert.key;

    #    ssl_session_cache    shared:SSL:1m;
    #    ssl_session_timeout  5m;

    #    ssl_ciphers  HIGH:!aNULL:!MD5;
    #    ssl_prefer_server_ciphers  on;

    #    location / {
    #        root   html;
    #        index  index.html index.htm;
    #    }
    #}

}

```

	ä»é…ç½®å¯ä»¥çœ‹å‡ºï¼ŒNginx ç›‘å¬äº† 80 ç«¯å£ã€åŸŸåä¸º localhostã€æ ¹è·¯å¾„ä¸º html æ–‡ä»¶å¤¹ï¼ˆæˆ‘çš„å®‰è£…è·¯å¾„ä¸º /opt/nginx-1.7.7ï¼Œæ‰€ä»¥ /opt/nginx-1.7.7/htmlï¼‰ã€é»˜è®¤ index æ–‡ä»¶ä¸º index.htmlï¼Œindex.htm æœåŠ¡å™¨é”™è¯¯é‡å®šå‘åˆ° 50x.html é¡µé¢ã€‚

	å¯ä»¥çœ‹åˆ° /opt/nginx-1.7.7/html/ æœ‰ä»¥ä¸‹æ–‡ä»¶ï¼š

```language

shuaiqidewuduzaideMacBook-Pro:html runing_liu$ ls -a
.		..		50x.html	index.html
shuaiqidewuduzaideMacBook-Pro:html runing_liu$ 
shuaiqidewuduzaideMacBook-Pro:html runing_liu$ pwd
/Users/runing_liu/Downloads/install-soft/nginx-1.16.0/html
```

	è¿™ä¹Ÿæ˜¯ä¸Šé¢åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ http://localhostï¼Œèƒ½å¤Ÿæ˜¾ç¤ºæ¬¢è¿é¡µé¢çš„åŸå› ã€‚å®é™…ä¸Šè®¿é—®çš„æ˜¯ ../nginx-1.16.0/html æ–‡ä»¶ã€‚

### 4.2 location åŒ¹é…è§„åˆ™

	è¯­æ³•è§„åˆ™:
 
	location [=|~|~*|^~] /uri/ { â€¦ } 

|æ¨¡å¼|å«ä¹‰|
|-|-|-|
| location = /url   |=è¡¨ç¤ºç²¾ç¡®åŒ¹é… åªæœ‰å®Œå…¨åŒ¹é…æ‰èƒ½ç”Ÿæ•ˆ|
| location ^~ /url  |^~ å¼€å¤´å¯¹URLè·¯å¾„è¿›è¡Œå‰ç¼€åŒ¹é… å¹¶ä¸”åœ¨æ­£åˆ™ä¹‹å‰|
| llocation ~ pattern   |å¼€å¤´è¡¨ç¤ºåŒºåˆ†å¤§å°å†™çš„æ­£åˆ™åŒ¹é…|
| location ~* pattern   |å¼€å¤´è¡¨ç¤ºä¸åŒºåˆ†å¤§å°å†™çš„æ­£åˆ™åŒ¹é…|
| location /uri   |ä¸å¸¦ä»»ä½•ä¿®é¥°ç¬¦ï¼Œä¹Ÿè¡¨ç¤ºå‰ç¼€åŒ¹é…ï¼Œä½†æ˜¯åœ¨æ­£åˆ™åŒ¹é…ä¹‹å|
| location /   |é€šç”¨åŒ¹é…ï¼Œä»»ä½•æœªåŒ¹é…åˆ°å…¶å®ƒlocationçš„è¯·æ±‚éƒ½ä¼šåŒ¹é…åˆ°ï¼Œç›¸å½“äºswitchä¸­çš„default|

	å‰ç¼€åŒ¹é…æ—¶ï¼ŒNginx ä¸å¯¹ url åšç¼–ç ï¼Œå› æ­¤è¯·æ±‚ä¸º /static/20%/aaï¼Œå¯ä»¥è¢«è§„åˆ™ ^~ /static/ /aa åŒ¹é…åˆ°ï¼ˆæ³¨æ„æ˜¯ç©ºæ ¼ï¼‰

	å¤šä¸ª location é…ç½®çš„æƒ…å†µä¸‹åŒ¹é…é¡ºåºä¸ºï¼ˆå‚è€ƒèµ„æ–™è€Œæ¥ï¼Œè¿˜æœªå®é™…éªŒè¯ï¼Œè¯•è¯•å°±çŸ¥é“äº†ï¼Œä¸å¿…æ‹˜æ³¥ï¼Œä»…ä¾›å‚è€ƒï¼‰:

- 	é¦–å…ˆç²¾ç¡®åŒ¹é… =
- 	å…¶æ¬¡å‰ç¼€åŒ¹é… ^~
- 	å…¶æ¬¡æ˜¯æŒ‰æ–‡ä»¶ä¸­é¡ºåºçš„æ­£åˆ™åŒ¹é…
- 	ç„¶ååŒ¹é…ä¸å¸¦ä»»ä½•ä¿®é¥°çš„å‰ç¼€åŒ¹é…ã€‚
- 	æœ€åæ˜¯äº¤ç»™ / é€šç”¨åŒ¹é…
- 	å½“æœ‰åŒ¹é…æˆåŠŸæ—¶å€™ï¼Œåœæ­¢åŒ¹é…ï¼ŒæŒ‰å½“å‰åŒ¹é…è§„åˆ™å¤„ç†è¯·æ±‚


	å®é™…ä½¿ç”¨ä¸­ï¼Œåº”è¯¥è‡³å°‘æœ‰ä¸‰ä¸ªåŒ¹é…è§„åˆ™å®šä¹‰ï¼Œå¦‚ä¸‹:

```language
# ç›´æ¥åŒ¹é…ç½‘ç«™æ ¹ï¼Œé€šè¿‡åŸŸåè®¿é—®ç½‘ç«™é¦–é¡µæ¯”è¾ƒé¢‘ç¹ï¼Œä½¿ç”¨è¿™ä¸ªä¼šåŠ é€Ÿå¤„ç†ï¼Œå®˜ç½‘å¦‚æ˜¯è¯´ã€‚
# è¿™é‡Œæ˜¯ç›´æ¥è½¬å‘ç»™åç«¯åº”ç”¨æœåŠ¡å™¨äº†ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªé™æ€é¦–é¡µ
# ç¬¬ä¸€ä¸ªå¿…é€‰è§„åˆ™
location = / {
    proxy_pass http://tomcat:8080/index
}

# ç¬¬äºŒä¸ªå¿…é€‰è§„åˆ™æ˜¯å¤„ç†é™æ€æ–‡ä»¶è¯·æ±‚ï¼Œè¿™æ˜¯ nginx ä½œä¸º http æœåŠ¡å™¨çš„å¼ºé¡¹
# æœ‰ä¸¤ç§é…ç½®æ¨¡å¼ï¼Œç›®å½•åŒ¹é…æˆ–åç¼€åŒ¹é…ï¼Œä»»é€‰å…¶ä¸€æˆ–æ­é…ä½¿ç”¨
location ^~ /static/ {
    root /webroot/static/;
}
location ~* \.(gif|jpg|jpeg|png|css|js|ico)$ {
    root /webroot/res/;
}

# ç¬¬ä¸‰ä¸ªè§„åˆ™å°±æ˜¯é€šç”¨è§„åˆ™ï¼Œç”¨æ¥è½¬å‘åŠ¨æ€è¯·æ±‚åˆ°åç«¯åº”ç”¨æœåŠ¡å™¨
# éé™æ€æ–‡ä»¶è¯·æ±‚å°±é»˜è®¤æ˜¯åŠ¨æ€è¯·æ±‚ï¼Œè‡ªå·±æ ¹æ®å®é™…æŠŠæ¡
# æ¯•ç«Ÿç›®å‰çš„ä¸€äº›æ¡†æ¶çš„æµè¡Œï¼Œå¸¦.phpã€.jspåç¼€çš„æƒ…å†µå¾ˆå°‘äº†
location / {
    proxy_pass http://tomcat:8080/
}
# [æ›´å¤šè¯¦æƒ…=>åŸæ–‡é“¾æ¥åœ°å€](https://wiki.jikexueyuan.com/project/openresty/ngx/nginx_local_pcre.html)
```
	

	å°ç¼–æ­£åœ¨åŠªåŠ›ğŸ’ªing

ã€Šæœ¬ç«™ç›¸å…³é“¾æ¥ã€‹:[(Nginxç›¸å…³ä»‹ç»(Nginxæ˜¯ä»€ä¹ˆ?èƒ½å¹²å˜›?))](https://www.cnblogs.com/wcwnina/p/8728391.html)